<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Project Flight Plan Submission Form</title>
    <style>
      body {
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
        background-color: #f0f8ff;
        margin: 0;
        padding: 20px;
        color: #333;
      }
      .container {
        max-width: 800px;
        margin: 0 auto;
        background-color: white;
        padding: 30px;
        border-radius: 10px;
        box-shadow: 0 0 20px rgba(0, 0, 0, 0.1);
      }
      h1 {
        text-align: center;
        color: #003366;
        margin-bottom: 30px;
      }
      .form-group {
        margin-bottom: 20px;
      }
      label {
        display: block;
        margin-bottom: 8px;
        font-weight: 600;
        color: #003366;
      }
      input,
      select,
      textarea {
        width: 100%;
        padding: 12px;
        border: 1px solid #ccc;
        border-radius: 5px;
        font-size: 16px;
        box-sizing: border-box;
      }
      .radio-group {
        display: flex;
        gap: 20px;
      }
      .radio-item {
        display: flex;
        align-items: center;
        gap: 5px;
      }
      .radio-item input {
        width: auto;
      }
      button {
        background-color: #0066cc;
        color: white;
        border: none;
        padding: 14px 20px;
        font-size: 16px;
        border-radius: 5px;
        cursor: pointer;
        width: 100%;
        font-weight: bold;
        transition: background-color 0.3s;
      }
      button:hover {
        background-color: #004c99;
      }
      .form-row {
        display: flex;
        gap: 20px;
        margin-bottom: 20px;
      }
      .form-col {
        flex: 1;
      }
      .submitted-plan {
        margin-top: 30px;
        padding: 20px;
        background-color: #e6f7ff;
        border-left: 5px solid #0066cc;
        border-radius: 5px;
        display: none;
      }
      .submitted-plan h2 {
        margin-top: 0;
        color: #003366;
      }
      .submitted-plan p {
        margin: 5px 0;
      }
      .header-icon {
        text-align: center;
        font-size: 48px;
        margin-bottom: 10px;
      }
      .required:after {
        content: " *";
        color: #cc0000;
      }
      .status-message {
        margin-top: 20px;
        padding: 15px;
        border-radius: 5px;
        text-align: center;
        font-weight: bold;
        display: none;
      }
      .status-message.success {
        background-color: #d4edda;
        color: #155724;
        border: 1px solid #c3e6cb;
      }
      .status-message.error {
        background-color: #f8d7da;
        color: #721c24;
        border: 1px solid #f5c6cb;
      }
      .loading {
        display: none;
        text-align: center;
        margin-top: 20px;
      }
      .loading-spinner {
        border: 4px solid #f3f3f3;
        border-top: 4px solid #0066cc;
        border-radius: 50%;
        width: 30px;
        height: 30px;
        animation: spin 1s linear infinite;
        margin: 0 auto;
      }
      @keyframes spin {
        0% {
          transform: rotate(0deg);
        }
        100% {
          transform: rotate(360deg);
        }
      }
    </style>
  </head>
  <body>
    <div class="container">
      <div class="header-icon">‚úàÔ∏è</div>
      <h1>Project Flight Plan Submission</h1>

      <form id="flightPlanForm">
        <div class="form-row">
          <div class="form-col">
            <div class="form-group">
              <label for="callsign" class="required">Callsign</label>
              <input
                type="text"
                id="callsign"
                name="callsign"
                placeholder="e.g. AAL123"
                required
              />
            </div>
          </div>
          <div class="form-col">
            <div class="form-group">
              <label for="aircraft" class="required">Aircraft Type</label>
              <input
                type="text"
                id="aircraft"
                name="aircraft"
                placeholder="e.g. B738"
                required
              />
            </div>
          </div>
        </div>

        <div class="form-group">
          <label class="required">Flight Rules</label>
          <div class="radio-group">
            <div class="radio-item">
              <input
                type="radio"
                id="ifr"
                name="flightRules"
                value="IFR"
                checked
              />
              <label for="ifr">IFR</label>
            </div>
            <div class="radio-item">
              <input type="radio" id="vfr" name="flightRules" value="VFR" />
              <label for="vfr">VFR</label>
            </div>
          </div>
        </div>

        <div class="form-row">
          <div class="form-col">
            <div class="form-group">
              <label for="departure" class="required">Departing From</label>
              <select id="departure" name="departure" required>
                <option value="">-- Select Departure Airport --</option>
                <optgroup label="Dominican Republic üá©üá¥">
                  <option value="MDAB">Arroyo Barril [MDAB]</option>
                  <option value="MDCR">Cabo Rojo [MDCR]</option>
                  <option value="MDST">Cibao [MDST]</option>
                  <option value="MDPC">Punta Cana [MDPC]</option>
                </optgroup>
                <optgroup label="Finland üá´üáÆ">
                  <option value="EFKT">Kittil√§ [EFKT]</option>
                </optgroup>
                <optgroup label="Haiti üá≠üáπ">
                  <option value="MTCA">Antoine-Simon [MTCA]</option>
                </optgroup>
                <optgroup label="Spain üá™üá∏">
                  <option value="GCLP">Gran Canaria [GCLP]</option>
                  <option value="LEMH">Menorca [LEMH]</option>
                </optgroup>
                <optgroup label="United Kingdom üá¨üáß">
                  <option value="EGKK">Gatwick [EGKK]</option>
                  <option value="EGHI">Southampton [EGHI]</option>
                </optgroup>
                <optgroup label="Cyprus üá®üáæ">
                  <option value="LCLK">Larnaca [LCLK]</option>
                </optgroup>
              </select>
            </div>
          </div>
          <div class="form-col">
            <div class="form-group">
              <label for="arrival" class="required">Arriving At</label>
              <select id="arrival" name="arrival" required>
                <option value="">-- Select Arrival Airport --</option>
                <optgroup label="Dominican Republic üá©üá¥">
                  <option value="MDAB">Arroyo Barril [MDAB]</option>
                  <option value="MDCR">Cabo Rojo [MDCR]</option>
                  <option value="MDST">Cibao [MDST]</option>
                  <option value="MDPC">Punta Cana [MDPC]</option>
                </optgroup>
                <optgroup label="Finland üá´üáÆ">
                  <option value="EFKT">Kittil√§ [EFKT]</option>
                </optgroup>
                <optgroup label="Haiti üá≠üáπ">
                  <option value="MTCA">Antoine-Simon [MTCA]</option>
                </optgroup>
                <optgroup label="Spain üá™üá∏">
                  <option value="GCLP">Gran Canaria [GCLP]</option>
                  <option value="LEMH">Menorca [LEMH]</option>
                </optgroup>
                <optgroup label="United Kingdom üá¨üáß">
                  <option value="EGKK">Gatwick [EGKK]</option>
                  <option value="EGHI">Southampton [EGHI]</option>
                </optgroup>
                <optgroup label="Cyprus üá®üáæ">
                  <option value="LCLK">Larnaca [LCLK]</option>
                </optgroup>
              </select>
            </div>
          </div>
        </div>

        <div class="form-group">
          <label for="cruiseFL" class="required">Cruising Flight Level</label>
          <input
            type="text"
            id="cruiseFL"
            name="cruiseFL"
            placeholder="e.g. FL350"
            required
          />
        </div>

        <div class="form-group">
          <label for="route">Route (Optional)</label>
          <textarea
            id="route"
            name="route"
            rows="3"
            placeholder="Enter your planned route"
          ></textarea>
        </div>

        <div class="form-group">
          <label for="departureTime">Estimated Departure Time (UTC)</label>
          <input type="time" id="departureTime" name="departureTime" />
        </div>

        <div class="form-group">
          <label for="remarks">Remarks (Optional)</label>
          <textarea
            id="remarks"
            name="remarks"
            rows="2"
            placeholder="Any additional information"
          ></textarea>
        </div>

        <div class="form-group">
          <button type="submit" id="submitButton">Submit Flight Plan</button>
        </div>
      </form>

      <div class="loading" id="loadingIndicator">
        <div class="loading-spinner"></div>
        <p>Submitting flight plan...</p>
      </div>

      <div class="status-message success" id="successMessage">
        Flight plan submitted successfully!
      </div>

      <div class="status-message error" id="errorMessage">
        Error submitting flight plan. Please try again.
      </div>

      <div id="submittedPlan" class="submitted-plan">
        <h2>Filed Flight Plan</h2>
        <p><strong>Callsign:</strong> <span id="displayCallsign"></span></p>
        <p><strong>Aircraft:</strong> <span id="displayAircraft"></span></p>
        <p>
          <strong>Flight Rules:</strong> <span id="displayFlightRules"></span>
        </p>
        <p><strong>Departing:</strong> <span id="displayDeparture"></span></p>
        <p><strong>Arriving:</strong> <span id="displayArrival"></span></p>
        <p>
          <strong>Cruising Level:</strong> <span id="displayCruiseFL"></span>
        </p>
        <p><strong>Route:</strong> <span id="displayRoute"></span></p>
        <p>
          <strong>Departure Time (UTC):</strong>
          <span id="displayDepartureTime"></span>
        </p>
        <p><strong>Remarks:</strong> <span id="displayRemarks"></span></p>
      </div>
    </div>

    <!-- Firebase SDK -->
    <script type="module">
      // Import the functions you need from the SDKs you need
      import { initializeApp } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-app.js";
      import { getAnalytics } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-analytics.js";
      import {
        getDatabase,
        ref,
        push,
      } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-database.js";

      // Your web app's Firebase configuration
      const firebaseConfig = {
        apiKey: "AIzaSyCh91PqE44G_LIZFmbjTiQKimLR4WiFZMA",
        authDomain: "thplan-75764.firebaseapp.com",
        databaseURL:
          "https://thplan-75764-default-rtdb.asia-southeast1.firebasedatabase.app",
        projectId: "thplan-75764",
        storageBucket: "thplan-75764.firebasestorage.app",
        messagingSenderId: "591288114375",
        appId: "1:591288114375:web:e628a649c67b5657e9b2e2",
        measurementId: "G-C5QJ18S1ZV",
      };

      // Initialize Firebase
      const app = initializeApp(firebaseConfig);
      const analytics = getAnalytics(app);
      const db = getDatabase(app);

      // Form submission
      document
        .getElementById("flightPlanForm")
        .addEventListener("submit", async function (e) {
          e.preventDefault();

          // Show loading indicator
          document.getElementById("loadingIndicator").style.display = "block";
          document.getElementById("submitButton").disabled = true;

          // Hide previous messages
          document.getElementById("successMessage").style.display = "none";
          document.getElementById("errorMessage").style.display = "none";

          // Get form values
          const callsign = document.getElementById("callsign").value;
          const aircraft = document.getElementById("aircraft").value;
          const flightRules = document.querySelector(
            'input[name="flightRules"]:checked'
          ).value;

          // Get the selected airport values and text
          const departureSelect = document.getElementById("departure");
          const arrivalSelect = document.getElementById("arrival");
          const departureCode = departureSelect.value;
          const arrivalCode = arrivalSelect.value;
          const departureText =
            departureSelect.options[departureSelect.selectedIndex].text;
          const arrivalText =
            arrivalSelect.options[arrivalSelect.selectedIndex].text;

          const cruiseFL = document.getElementById("cruiseFL").value;
          const route = document.getElementById("route").value || "Direct";
          const departureTime =
            document.getElementById("departureTime").value || "";
          const remarks = document.getElementById("remarks").value || "";

          // Prepare flight plan data
          const flightPlanData = {
            callsign: callsign,
            aircraft: aircraft,
            flightRules: flightRules,
            departureCode: departureCode,
            departureText: departureText,
            arrivalCode: arrivalCode,
            arrivalText: arrivalText,
            cruiseFL: cruiseFL,
            route: route,
            departureTime: departureTime,
            remarks: remarks,
            timestamp: new Date().toISOString(),
          };

          try {
            // Add document to Firebase Realtime Database
            const flightPlansRef = ref(db, "flightPlans");
            const newFlightRef = push(flightPlansRef, flightPlanData);
            console.log("Flight plan submitted to Realtime Database.");

            // Display success message
            document.getElementById("successMessage").style.display = "block";

            // Display the submitted plan
            document.getElementById("displayCallsign").textContent = callsign;
            document.getElementById("displayAircraft").textContent = aircraft;
            document.getElementById("displayFlightRules").textContent =
              flightRules;
            document.getElementById("displayDeparture").textContent =
              departureText;
            document.getElementById("displayArrival").textContent = arrivalText;
            document.getElementById("displayCruiseFL").textContent = cruiseFL;
            document.getElementById("displayRoute").textContent = route;
            document.getElementById("displayDepartureTime").textContent =
              departureTime || "Not specified";
            document.getElementById("displayRemarks").textContent =
              remarks || "None";

            document.getElementById("submittedPlan").style.display = "block";
          } catch (error) {
            console.error("Error submitting flight plan: ", error);
            document.getElementById("errorMessage").style.display = "block";
            document.getElementById(
              "errorMessage"
            ).textContent = `Error submitting flight plan: ${error.message}`;
          } finally {
            // Hide loading indicator and re-enable submit button
            document.getElementById("loadingIndicator").style.display = "none";
            document.getElementById("submitButton").disabled = false;
          }
        });
    </script>
  </body>
</html>
